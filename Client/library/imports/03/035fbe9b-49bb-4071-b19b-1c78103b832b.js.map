{"version":3,"sources":["..\\..\\..\\..\\..\\..\\assets\\resources\\resources\\scriptes/assets\\resources\\resources\\scriptes\\Hall.js"],"names":["NetWorkManager","require","CreatorHelper","Users","cc","Class","extends","Component","properties","headSprite","Sprite","playerName","Label","playerId","fangkaNum","createRoomBn","Node","enterRoomBn","createConfirm","juNumGroup","waitingPfb","Prefab","onLoad","self","setNodeClickEvent","custom","idx","children","toggle","getComponent","Toggle","isChecked","juNum","parseInt","node","name","onConnectedToHall","hallService","proxy","createRoom","data","ok","suc","log","roomId","connectAndAuthToGame","account","pass","url","onConnectedToGame","loginData","loginToGameData","isInGame","director","loadScene","clearGameService","clickCount","clearInput","num","numUi","find","toString","shownumUi","numLab","string","inputnumUi","evt","clickNum","tabNumStr","joinTable","reinputUi","deleteUi","numlab","onClose","bg","instantiate","addChild","removeFromParent","onClosedFromHall","bind","tableId","gameUrl","alert","start","getPlayerBaseInfo","baseInfo","info","nickName","id","score","headimgurl","headimgUrl","changeSpriteFrameWithServerUrl"],"mappings":"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","file":"Hall.js","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\resources\\resources\\scriptes","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] http://www.cocos.com/docs/creator/scripting/class.html\n//  - [English] http://www.cocos2d-x.org/docs/editors_and_tools/creator-chapters/scripting/class/index.html\n// Learn Attribute:\n//  - [Chinese] http://www.cocos.com/docs/creator/scripting/reference/attributes.html\n//  - [English] http://www.cocos2d-x.org/docs/editors_and_tools/creator-chapters/scripting/reference/attributes/index.html\n// Learn life-cycle callbacks:\n//  - [Chinese] http://www.cocos.com/docs/creator/scripting/life-cycle-callbacks.html\n//  - [English] http://www.cocos2d-x.org/docs/editors_and_tools/creator-chapters/scripting/life-cycle-callbacks/index.html\n\nvar NetWorkManager = require(\"NetWorkManager\");\nvar CreatorHelper = require(\"CreatorHelper\");\nvar Users = require(\"Users\");\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        // foo: {\n        //     // ATTRIBUTES:\n        //     default: null,        // The default value will be used only when the component attaching\n        //                           // to a node for the first time\n        //     type: cc.SpriteFrame, // optional, default is typeof default\n        //     serializable: true,   // optional, default is true\n        // },\n        // bar: {\n        //     get () {\n        //         return this._bar;\n        //     },\n        //     set (value) {\n        //         this._bar = value;\n        //     }\n        // },\n        headSprite:cc.Sprite,//Head picture\n        playerName:cc.Label,//Player name\n        playerId:cc.Label,//player id\n        fangkaNum:cc.Label,//score\n        createRoomBn:cc.Node,//Create room button\n        enterRoomBn:cc.Node,//Add room button\n        createConfirm:cc.Node,\n        juNumGroup:cc.Node,\n        waitingPfb:cc.Prefab\n\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    onLoad () {\n        var self = this;\n        CreatorHelper.setNodeClickEvent(this.createConfirm,function(){\n            var custom = {};\n            for(var idx in self.juNumGroup.children){\n                var toggle = self.juNumGroup.children[idx].getComponent(cc.Toggle);\n                if(toggle.isChecked){\n                    custom.juNum = parseInt(toggle.node.name);\n                    break;\n                }\n            }\n            \n            NetWorkManager.onConnectedToHall(function (hallService) {\n                hallService.proxy.createRoom(custom,function (data) {\n                    if(data.ok && data.suc){\n                        cc.log('RoomID: %o',data.roomId);\n                        cc.log('Data: %o',data);\n                        NetWorkManager.connectAndAuthToGame(Users.account,Users.pass,data.url);\n                        NetWorkManager.onConnectedToGame(function () {\n                            var loginData = Users.loginToGameData;\n                            if(loginData.isInGame){\n                                cc.director.loadScene(\"game\");\n                            }else{\n                                NetWorkManager.clearGameService();\n                            }\n                        })\n                    }else{\n\n                    }\n                });\n            });\n        });\n        //-------------------------------Joining house price--------------------------------------------------\n        var self = this;\n        this.clickCount = 0;\n        var clearInput = function () {\n            for(var num=0;num<=5;num++){\n                var numUi = cc.find(num.toString(),self.shownumUi);\n                var numLab = cc.find(\"txt\",numUi).getComponent(cc.Label);\n                numLab.string = \"\";\n            }\n            self.clickCount = 0;\n        }\n        this.shownumUi = cc.find(\"joinroot/joinbg/shownums\",this.node);\n        CreatorHelper.setNodeClickEvent(this.enterRoomBn,function () {\n            clearInput();\n        }); \n        this.inputnumUi = cc.find(\"joinroot/joinbg/inputnums\",this.node);\n            for(var num=0;num<=9;num++){\n                var numUi = cc.find(num.toString(),this.inputnumUi);\n                CreatorHelper.setNodeClickEvent(numUi,function (evt) {\n                    if(self.clickCount<6){\n                        var clickNum = evt.name;\n                        var numUi = cc.find(self.clickCount.toString(),self.shownumUi);\n                        var numLab = cc.find(\"txt\",numUi).getComponent(cc.Label);\n                        numLab.string = clickNum;\n                        self.clickCount++; \n                    }else{\n                        if(self.clickCount===6){\n                            var tabNumStr = \"\";\n                            for(var idx=0;idx<=5;idx++){\n                                var numUi = cc.find(idx.toString(),self.shownumUi);\n                                var numLab = cc.find(\"txt\",numUi).getComponent(cc.Label);\n                                tabNumStr+=numLab.string;\n                            }\n                            cc.log(tabNumStr);\n                            self.joinTable(tabNumStr);\n                        }\n                    }\n                }); \n        }\n        var reinputUi = cc.find(\"reinput\",this.inputnumUi);\n        var deleteUi = cc.find(\"delete\",this.inputnumUi);\n        CreatorHelper.setNodeClickEvent(reinputUi,function (evt) {\n            clearInput();\n        }); \n        CreatorHelper.setNodeClickEvent(deleteUi,function (evt) {\n            if(self.clickCount == 0)return;\n            self.clickCount--;\n            var numUi = cc.find(self.clickCount.toString(),self.shownumUi);\n            var numlab = cc.find(\"txt\",numUi).getComponent(cc.Label);\n            numlab.string = '';\n        }); \n        //------------------------daunxianjiemian \n        this.onClose = function () {\n            var bg = cc.instantiate(this.waitingPfb);\n            this.node.addChild(bg); \n            NetWorkManager.onConnectedToHall(function () {\n                bg.removeFromParent(true);\n            });\n        }\n        NetWorkManager.onClosedFromHall(this.onClose.bind(this));\n        \n    },\n    joinTable(tableId){\n        NetWorkManager.onConnectedToHall(function (hallService) {\n            hallService.proxy.joinTable(tableId,function (data) {\n                if(data.ok && data.suc){\n                    NetWorkManager.connectAndAuthToGame(Users.account,Users.pass,data.gameUrl);\n                    NetWorkManager.onConnectedToGame(function () {\n                        var loginData = Users.loginToGameData;\n                        //var loginDataInfo = JSON.stringify(loginData);\n                        //cc.log(\"loginData: \"+loginDataInfo.inRoomInfo);\n                        if(loginData.isInGame){\n                            cc.director.loadScene(\"game\");\n                            cc.log(data.gameUrl);\n                            //NetWorkManager.offClosedFromHall(this.onClose.bind(this));\n                            //NetWorkManager.clearHallService();\n                        }else{\n                            NetWorkManager.clearGameService();\n                        }\n                    })\n                }else{\n                    alert('Failed to join room');\n                }\n            });\n        });\n    },\n    start () {\n        var self = this;\n        NetWorkManager.onConnectedToHall(function (hallService) {\n            hallService.proxy.getPlayerBaseInfo(function (data) {\n                if(data.ok && data.suc){//Information obtained successfully\n                     var baseInfo = data.info;\n                     self.playerName.string = baseInfo.nickName;\n                     self.playerId.string = baseInfo.id;\n                     self.fangkaNum.string = baseInfo.score;\n                     /*var frame = new cc.SpriteFrame();\n                     frame.setTexture(baseInfo.headimgUrl);\n                     self.headSprite.spriteFrame = frame;*/\n                     var headimgurl = baseInfo.headimgUrl;\n                     //head image\n                     CreatorHelper.changeSpriteFrameWithServerUrl(self.headSprite,headimgurl);\n                }else{//Failed to get information, prompt user\n                    alert('Failed to get user information');\n                }\n            });\n        })\n    },\n    // update (dt) {},\n});"]}