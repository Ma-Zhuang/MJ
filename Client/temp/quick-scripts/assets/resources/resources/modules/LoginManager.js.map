{"version":3,"sources":["LoginManager.js"],"names":["UnitTools","require","Config","NetWorkManager","Users","LoginManager","account","pass","request","testLoginUrl","err","data","cc","log","JSON","parse","ok","suc","hallUrl","connectAndAuthToHall","onConnectedToHall","loginToHallData","isInGame","connectAndAuthToGame","gameUrl","onConnectedToGame","loginData","loginToGameData","director","loadScene","clearGameService","alert","nickName","headUrl","fangka","module","exports"],"mappings":";;;;;;;;;;AAAA,IAAIA,YAAYC,QAAQ,WAAR,CAAhB;AACA,IAAIC,SAASD,QAAQ,QAAR,CAAb;AACA,IAAIE,iBAAiBF,QAAQ,gBAAR,CAArB;AACA,IAAIG,QAAQH,QAAQ,OAAR,CAAZ;;IACMI;;;;;;;kCACeC,SAAQC,MAAK;AAC1BP,sBAAUQ,OAAV,CAAkBN,OAAOO,YAAzB,EAAsC,EAACH,SAAQA,OAAT,EAAiBC,MAAKA,IAAtB,EAAtC,EAAkE,UAAUG,GAAV,EAAcC,IAAd,EAAoB;AAClF,oBAAGD,GAAH,EAAO;AACHE,uBAAGC,GAAH,CAAO,oBAAP;AACAD,uBAAGC,GAAH,CAAOF,IAAP;AACA;AACH;AACDA,uBAAOG,KAAKC,KAAL,CAAWJ,IAAX,CAAP;AACA,oBAAGA,KAAKK,EAAL,IAAS,IAAT,IAAiBL,KAAKM,GAAL,IAAU,IAA9B,EAAmC;AAC/Bb,0BAAMc,OAAN,GAAgB,UAAQP,KAAKO,OAA7B;AACAf,mCAAegB,oBAAf,CAAoCR,KAAKL,OAAzC,EAAiDK,KAAKJ,IAAtD,EAA2D,UAAQI,KAAKO,OAAxE;AACAf,mCAAeiB,iBAAf,CAAiC,YAAY;AACzCR,2BAAGC,GAAH,CAAO,cAAYT,MAAMiB,eAAN,CAAsBC,QAAzC;AACA,4BAAGlB,MAAMiB,eAAN,CAAsBC,QAAzB,EAAkC;AAAC;AAC/BnB,2CAAeoB,oBAAf,CAAoCnB,MAAME,OAA1C,EAAkDF,MAAMG,IAAxD,EAA6DH,MAAMiB,eAAN,CAAsBG,OAAnF;AACArB,2CAAesB,iBAAf,CAAiC,YAAY;AACzC,oCAAIC,YAAYtB,MAAMuB,eAAtB;AACA,oCAAGD,UAAUJ,QAAb,EAAsB;AAClBV,uCAAGgB,QAAH,CAAYC,SAAZ,CAAsB,MAAtB;AACH,iCAFD,MAEK;AACD1B,mDAAe2B,gBAAf;AACH;AACJ,6BAPD;AAQH,yBAVD,MAUK;AACDlB,+BAAGgB,QAAH,CAAYC,SAAZ,CAAsB,MAAtB;AACH;AACJ,qBAfD;AAgBH,iBAnBD,MAmBM,IAAGlB,KAAKK,EAAL,IAAS,IAAT,IAAiBL,KAAKM,GAAL,IAAU,KAA9B,EAAoC;AACtCc,0BAAM,iCAAN;AACH,iBAFK,MAEA,IAAGpB,KAAKK,EAAL,IAAS,KAAT,IAAkBL,KAAKM,GAAL,IAAU,KAA/B,EAAqC;AACvCc,0BAAM,4CAAN;AACH;AAEJ,aAhCD,EAgCE,IAhCF;AAiCH;;;;;;AAEL1B,aAAaC,OAAb,GAAqB,IAArB;AACAD,aAAaE,IAAb,GAAoB,IAApB;AACAF,aAAa2B,QAAb,GAAwB,EAAxB;AACA3B,aAAa4B,OAAb,GAAuB,EAAvB;AACA5B,aAAa6B,MAAb,GAAsB,IAAtB;AACAC,OAAOC,OAAP,GAAiB/B,YAAjB","file":"LoginManager.js","sourceRoot":"..\\..\\..\\..\\..\\..\\assets\\resources\\resources\\modules","sourcesContent":["var UnitTools = require('UnitTools');\r\nvar Config = require('Config');\r\nvar NetWorkManager = require('NetWorkManager');\r\nvar Users = require('Users');\r\nclass LoginManager{\r\n    static testLogin(account,pass){\r\n        UnitTools.request(Config.testLoginUrl,{account:account,pass:pass},function (err,data) {\r\n            if(err){\r\n                cc.log(\"Login exception!!!\");\r\n                cc.log(data);\r\n                return;\r\n            }\r\n            data = JSON.parse(data);\r\n            if(data.ok==true && data.suc==true){\r\n                Users.hallUrl = \"ws://\"+data.hallUrl;\r\n                NetWorkManager.connectAndAuthToHall(data.account,data.pass,\"ws://\"+data.hallUrl);\r\n                NetWorkManager.onConnectedToHall(function () {\r\n                    cc.log('ceshissss'+Users.loginToHallData.isInGame);\r\n                    if(Users.loginToHallData.isInGame){//Jump to the game interface\r\n                        NetWorkManager.connectAndAuthToGame(Users.account,Users.pass,Users.loginToHallData.gameUrl);\r\n                        NetWorkManager.onConnectedToGame(function () {\r\n                            var loginData = Users.loginToGameData;\r\n                            if(loginData.isInGame){\r\n                                cc.director.loadScene(\"game\");\r\n                            }else{\r\n                                NetWorkManager.clearGameService();\r\n                            }\r\n                        })\r\n                    }else{\r\n                        cc.director.loadScene(\"hall\");\r\n                    }\r\n                });\r\n            }else if(data.ok==true && data.suc==false){\r\n                alert('Wrong password, please re-enter');\r\n            }else if(data.ok==false && data.suc==false){\r\n                alert('User does not exist, please register first');\r\n            }\r\n            \r\n        },5000);\r\n    }\r\n}\r\nLoginManager.account=null;\r\nLoginManager.pass = null;\r\nLoginManager.nickName = \"\";\r\nLoginManager.headUrl = \"\";\r\nLoginManager.fangka = null;\r\nmodule.exports = LoginManager;"]}